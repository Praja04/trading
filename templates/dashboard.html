<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MT5 Trading Dashboard - Elite Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-primary: #0a0a0a;
        --bg-secondary: #121212;
        --bg-tertiary: #1a1a1a;
        --bg-card: #1e1e1e;
        --bg-hover: #252525;

        --border-primary: rgba(255, 255, 255, 0.06);
        --border-accent: rgba(0, 212, 255, 0.3);

        --text-primary: #ffffff;
        --text-secondary: #a0a0a0;
        --text-tertiary: #707070;

        --accent-cyan: #00d4ff;
        --accent-purple: #7b2ff7;
        --accent-pink: #f107d4;

        --success: #00ff88;
        --success-glow: rgba(0, 255, 136, 0.2);
        --danger: #ff3366;
        --danger-glow: rgba(255, 51, 102, 0.2);
        --warning: #ffa500;

        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
        --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.7);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        padding: 20px;
        min-height: 100vh;
        line-height: 1.6;
      }

      .container {
        max-width: 2000px;
        margin: 0 auto;
      }

      /* Header Section */
      .header {
        background: linear-gradient(
          135deg,
          var(--bg-secondary) 0%,
          var(--bg-tertiary) 100%
        );
        padding: 30px 40px;
        border-radius: 16px;
        margin-bottom: 24px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-primary);
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--accent-cyan),
          var(--accent-purple),
          var(--accent-pink),
          var(--accent-cyan)
        );
        background-size: 200% 100%;
        animation: gradientShift 3s ease infinite;
      }

      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header-left h1 {
        background: linear-gradient(
          135deg,
          var(--accent-cyan) 0%,
          var(--accent-purple) 50%,
          var(--accent-pink) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 36px;
        font-weight: 900;
        letter-spacing: -1px;
        margin-bottom: 6px;
      }

      .header-left .subtitle {
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 255, 136, 0.1);
        padding: 6px 14px;
        border-radius: 20px;
        border: 1px solid rgba(0, 255, 136, 0.3);
      }

      .live-dot {
        width: 10px;
        height: 10px;
        background: var(--success);
        border-radius: 50%;
        animation: pulse 2s infinite;
        box-shadow: 0 0 12px var(--success);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.7;
          transform: scale(0.92);
        }
      }

      .header-right {
        text-align: right;
      }

      .server-time {
        font-size: 13px;
        color: var(--text-tertiary);
        margin-bottom: 4px;
      }

      .current-time {
        font-family: "JetBrains Mono", monospace;
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
        letter-spacing: -0.5px;
      }

      /* Live Market Data Section */
      .market-section {
        margin-bottom: 24px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 16px;
        padding-left: 4px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title::before {
        content: "";
        width: 4px;
        height: 20px;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        border-radius: 2px;
      }

      .market-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
        gap: 16px;
      }

      .market-card {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-tertiary) 100%
        );
        border-radius: 14px;
        padding: 20px;
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-md);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .market-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 3px;
        height: 100%;
        background: linear-gradient(
          180deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .market-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        border-color: var(--border-accent);
      }

      .market-card:hover::before {
        opacity: 1;
      }

      .market-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-primary);
      }

      .market-symbol {
        font-size: 22px;
        font-weight: 800;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
      }

      .market-status {
        font-size: 11px;
        font-weight: 600;
        color: var(--success);
        background: var(--success-glow);
        padding: 4px 10px;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .market-prices {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 14px;
      }

      .price-box {
        background: var(--bg-secondary);
        padding: 12px;
        border-radius: 10px;
        border: 1px solid var(--border-primary);
      }

      .price-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
      }

      .price-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
        letter-spacing: -0.5px;
      }

      .price-value.bid {
        color: var(--danger);
      }

      .price-value.ask {
        color: var(--success);
      }

      .market-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .detail-item {
        background: var(--bg-secondary);
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border-primary);
      }

      .detail-label {
        font-size: 10px;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.3px;
        margin-bottom: 3px;
      }

      .detail-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Account & Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-tertiary) 100%
        );
        padding: 22px;
        border-radius: 14px;
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-md);
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        border-color: var(--border-accent);
      }

      .stat-header {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.8px;
        margin-bottom: 12px;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -1px;
        margin-bottom: 4px;
      }

      .stat-change {
        font-size: 13px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .stat-change.positive {
        color: var(--success);
      }

      .stat-change.negative {
        color: var(--danger);
      }

      /* Drawdown Section */
      .drawdown-section {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-tertiary) 100%
        );
        border-radius: 14px;
        padding: 24px;
        margin-bottom: 24px;
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-md);
      }

      .drawdown-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .drawdown-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .drawdown-toggle {
        display: flex;
        gap: 8px;
      }

      .toggle-btn {
        padding: 8px 16px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .toggle-btn.active {
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        color: var(--text-primary);
        border-color: transparent;
      }

      .toggle-btn:hover:not(.active) {
        background: var(--bg-hover);
        color: var(--text-primary);
      }

      .drawdown-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 14px;
      }

      .drawdown-card {
        background: var(--bg-secondary);
        padding: 16px;
        border-radius: 10px;
        border: 1px solid var(--border-primary);
      }

      .drawdown-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
      }

      .drawdown-value {
        font-size: 24px;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -0.5px;
      }

      .drawdown-bar {
        height: 6px;
        background: var(--bg-primary);
        border-radius: 3px;
        margin-top: 10px;
        overflow: hidden;
      }

      .drawdown-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--danger), var(--warning));
        border-radius: 3px;
        transition: width 0.5s ease;
      }

      /* Positions & Trades Section */
      .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
      }

      @media (max-width: 1400px) {
        .content-grid {
          grid-template-columns: 1fr;
        }
      }

      .content-card {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-tertiary) 100%
        );
        border-radius: 14px;
        padding: 24px;
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-md);
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 14px;
        border-bottom: 2px solid var(--border-primary);
      }

      .content-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .content-count {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        background: var(--bg-secondary);
        padding: 6px 14px;
        border-radius: 12px;
      }

      /* Position Card */
      .position-item {
        background: var(--bg-secondary);
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 12px;
        border: 1px solid var(--border-primary);
        transition: all 0.3s ease;
      }

      .position-item:hover {
        background: var(--bg-hover);
        border-color: var(--border-accent);
        transform: translateX(4px);
      }

      .position-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .position-symbol-row {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .position-symbol {
        font-size: 18px;
        font-weight: 800;
        color: var(--text-primary);
      }

      .position-type {
        font-size: 11px;
        font-weight: 700;
        padding: 4px 10px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .position-type.buy {
        background: var(--success-glow);
        color: var(--success);
      }

      .position-type.sell {
        background: var(--danger-glow);
        color: var(--danger);
      }

      .position-profit {
        font-size: 20px;
        font-weight: 800;
        letter-spacing: -0.5px;
      }

      .position-profit.positive {
        color: var(--success);
      }

      .position-profit.negative {
        color: var(--danger);
      }

      .position-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding-top: 12px;
        border-top: 1px solid var(--border-primary);
      }

      .position-detail {
        text-align: center;
      }

      .position-detail-label {
        font-size: 10px;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.3px;
        margin-bottom: 3px;
      }

      .position-detail-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Trade History */
      .trade-item {
        background: var(--bg-secondary);
        border-radius: 8px;
        padding: 12px 14px;
        margin-bottom: 8px;
        border: 1px solid var(--border-primary);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s ease;
      }

      .trade-item:hover {
        background: var(--bg-hover);
      }

      .trade-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
      }

      .trade-time {
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        color: var(--text-tertiary);
        min-width: 65px;
      }

      .trade-symbol {
        font-size: 13px;
        font-weight: 700;
        color: var(--text-primary);
        min-width: 85px;
      }

      .trade-type {
        font-size: 10px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .trade-type.buy {
        background: var(--success-glow);
        color: var(--success);
      }

      .trade-type.sell {
        background: var(--danger-glow);
        color: var(--danger);
      }

      .trade-profit {
        font-family: "JetBrains Mono", monospace;
        font-size: 14px;
        font-weight: 700;
      }

      .trade-profit.positive {
        color: var(--success);
      }

      .trade-profit.negative {
        color: var(--danger);
      }

      /* Strategy Info */
      .strategy-card {
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          var(--bg-tertiary) 100%
        );
        border-radius: 14px;
        padding: 24px;
        margin-bottom: 24px;
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-md);
      }

      .strategy-active {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 18px;
        padding: 16px;
        background: var(--bg-secondary);
        border-radius: 10px;
        border-left: 4px solid var(--accent-cyan);
      }

      .strategy-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .strategy-info-text h3 {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 4px;
      }

      .strategy-meta {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .upload-section {
        padding-top: 18px;
        border-top: 1px solid var(--border-primary);
      }

      .upload-section h3 {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
      }

      .file-input-wrapper {
        position: relative;
        margin-bottom: 12px;
      }

      .file-input-label {
        display: inline-block;
        padding: 10px 20px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-input-label:hover {
        background: var(--bg-hover);
        border-color: var(--border-accent);
      }

      input[type="file"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .upload-btn {
        padding: 10px 24px;
        background: linear-gradient(
          135deg,
          var(--accent-cyan),
          var(--accent-purple)
        );
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 700;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .upload-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 212, 255, 0.4);
      }

      .upload-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .selected-file {
        margin-top: 8px;
        font-size: 12px;
        color: var(--text-secondary);
      }

      /* Utilities */
      .no-data {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-tertiary);
        font-size: 14px;
      }

      .error {
        color: var(--danger);
        font-size: 13px;
        margin-top: 8px;
      }

      .success {
        color: var(--success);
        font-size: 13px;
        margin-top: 8px;
      }

      .fade-in {
        animation: fadeIn 0.4s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--bg-hover);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 20px;
        }

        .header-right {
          text-align: left;
          width: 100%;
        }

        .market-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }

      .news-list {
        max-height: 500px;
        overflow-y: auto;
      }

      .news-item {
        padding: 15px;
        border-bottom: 1px solid var(--border-primary);
        transition: background 0.2s;
      }

      .news-item:hover {
        background: var(--bg-hover);
      }

      .news-item.impact-high {
        border-left: 4px solid var(--danger);
      }

      .news-item.impact-medium {
        border-left: 4px solid var(--warning);
      }

      .news-item.impact-low {
        border-left: 4px solid var(--text-tertiary);
      }

      .news-time {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .news-title {
        font-weight: 600;
        margin: 5px 0;
        color: var(--text-primary);
      }

      .news-details {
        display: flex;
        gap: 15px;
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 5px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border-primary);
      }

      .tab-btn {
        padding: 10px 20px;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .tab-btn.active {
        color: var(--accent-cyan);
        border-bottom-color: var(--accent-cyan);
      }

      .tab-btn:hover {
        color: var(--text-primary);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .stats-grid .stat-card {
        padding: 15px;
        background: var(--bg-tertiary);
        border-radius: 8px;
        border: 1px solid var(--border-primary);
      }

      .stat-card .stat-label {
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 5px;
      }

      .stat-card .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .table-responsive {
        overflow-x: auto;
        max-height: 500px;
        overflow-y: auto;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-primary);
      }

      .data-table th {
        background: var(--bg-tertiary);
        position: sticky;
        top: 0;
        z-index: 10;
        font-weight: 600;
        color: var(--text-primary);
      }

      .data-table tr:hover {
        background: var(--bg-hover);
      }

      .profit-positive {
        color: var(--success);
        font-weight: 600;
      }

      .profit-negative {
        color: var(--danger);
        font-weight: 600;
      }

      .btn-danger {
        background: var(--danger);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }

      .btn-danger:hover {
        background: #ff4477;
        box-shadow: 0 4px 12px var(--danger-glow);
      }

      .btn-warning {
        background: var(--warning);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }

      .btn-warning:hover {
        background: #ffb733;
      }

      .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-primary);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary);
      }

      /* Price update animation */
      .price-value.price-update {
        animation: priceFlash 0.5s ease;
      }

      @keyframes priceFlash {
        0%,
        100% {
          background-color: transparent;
        }
        50% {
          background-color: rgba(0, 212, 255, 0.2);
        }
      }

      /* Smooth transitions for price values */
      .price-value {
        transition: background-color 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-content">
          <div class="header-left">
            <h1>MT5 TRADING DASHBOARD</h1>
            <div class="subtitle">
              <div class="live-indicator">
                <div class="live-dot"></div>
                <span>LIVE</span>
              </div>
              <span>FinexBisnisSolusi-Demo ‚Ä¢ Account #356000</span>
            </div>
          </div>
          <div class="header-right">
            <div class="server-time">SERVER TIME</div>
            <div class="current-time" id="current-time">--:--:--</div>
          </div>
        </div>
      </div>

      <!-- Live Market Data -->
      <div class="market-section">
        <div class="section-title">
          <span>üìä Live Market Data</span>
        </div>
        <div class="market-grid" id="market-data">
          <!-- Market cards will be dynamically loaded -->
        </div>
      </div>

      <!-- Account Stats -->
      <div class="stats-grid" id="account-stats">
        <!-- Stats cards will be dynamically loaded -->
      </div>

      <!-- Drawdown Section -->
      <div class="drawdown-section">
        <div class="drawdown-header">
          <div class="drawdown-title">‚ö†Ô∏è Drawdown Analysis</div>
          <div class="drawdown-toggle">
            <button
              class="toggle-btn active"
              id="toggle-global"
              onclick="toggleDrawdownView('global')"
            >
              Global
            </button>
            <button
              class="toggle-btn"
              id="toggle-per-pair"
              onclick="toggleDrawdownView('per-pair')"
            >
              Per Pair
            </button>
          </div>
        </div>
        <div class="drawdown-grid" id="drawdown-data">
          <!-- Drawdown cards will be dynamically loaded -->
        </div>
      </div>

      <!-- Strategy Info -->
      <div class="strategy-card">
        <div id="strategy-info">
          <!-- Strategy info will be dynamically loaded -->
        </div>
      </div>

      <!-- Positions & Trades -->
      <div class="content-grid">
        <!-- Open Positions -->
        <div class="content-card">
          <div class="content-header">
            <div class="content-title">üìà Open Positions</div>
            <div class="content-count" id="position-count">0</div>
          </div>
          <div id="positions">
            <!-- Positions will be dynamically loaded -->
          </div>
        </div>

        <!-- Trade History -->
        <div class="content-card">
          <div class="content-header">
            <div class="content-title">üìã Today's Trades</div>
            <div class="content-count" id="trade-count">0</div>
          </div>
          <div id="trades">
            <!-- Trades will be dynamically loaded -->
          </div>
        </div>
      </div>

      <!-- News Section -->
      <div class="card">
        <div class="card-header">
          <h2>üì∞ Economic News Calendar</h2>
          <div style="display: flex; gap: 10px">
            <button
              class="btn btn-primary"
              onclick="refreshNews()"
              style="padding: 8px 16px"
            >
              <span id="newsRefreshIcon">üîÑ</span> Refresh
            </button>
            <select
              id="newsFilter"
              onchange="filterNews()"
              style="
                padding: 8px;
                background: var(--bg-tertiary);
                color: var(--text-primary);
                border: 1px solid var(--border-primary);
                border-radius: 6px;
              "
            >
              <option value="all">All Impact</option>
              <option value="High">High Impact</option>
              <option value="Medium">Medium Impact</option>
              <option value="Low">Low Impact</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <div class="tabs">
            <button class="tab-btn active" onclick="switchNewsTab('upcoming')">
              Upcoming
            </button>
            <button class="tab-btn" onclick="switchNewsTab('recent')">
              Recent
            </button>
          </div>

          <div id="upcomingNewsTab" class="tab-content active">
            <div id="upcomingNewsList" class="news-list">
              <div class="loading">Loading upcoming news...</div>
            </div>
          </div>

          <div id="recentNewsTab" class="tab-content" style="display: none">
            <div id="recentNewsList" class="news-list">
              <div class="loading">Loading recent news...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Trade History Section -->
      <div class="card">
        <div class="card-header">
          <h2>üìä Trade History</h2>
          <div style="display: flex; gap: 10px">
            <button
              class="btn btn-primary"
              onclick="syncTradeHistory()"
              style="padding: 8px 16px"
            >
              <span id="syncIcon">‚¨áÔ∏è</span> Sync from MT5
            </button>
            <button
              class="btn btn-secondary"
              onclick="exportTradeHistory()"
              style="padding: 8px 16px"
            >
              üì• Export CSV
            </button>
            <select
              id="historyDaysFilter"
              onchange="loadTradeHistory()"
              style="
                padding: 8px;
                background: var(--bg-tertiary);
                color: var(--text-primary);
                border: 1px solid var(--border-primary);
                border-radius: 6px;
              "
            >
              <option value="7">Last 7 Days</option>
              <option value="30" selected>Last 30 Days</option>
              <option value="90">Last 90 Days</option>
              <option value="">All Time</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <!-- Statistics Summary -->
          <div
            id="tradeStats"
            class="stats-grid"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
              gap: 15px;
              margin-bottom: 20px;
            "
          >
            <!-- Stats will be populated by JavaScript -->
          </div>

          <!-- Trade History Table -->
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ticket</th>
                  <th>Symbol</th>
                  <th>Type</th>
                  <th>Volume</th>
                  <th>Open Price</th>
                  <th>Close Price</th>
                  <th>Open Time</th>
                  <th>Close Time</th>
                  <th>Duration</th>
                  <th>Profit</th>
                  <th>Commission</th>
                  <th>Swap</th>
                  <th>Net P/L</th>
                </tr>
              </thead>
              <tbody id="tradeHistoryTable">
                <tr>
                  <td colspan="13" class="loading">Loading trade history...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Close All Positions Button (add to positions section) -->
      <div class="card">
        <div class="card-header">
          <h2>‚ö†Ô∏è Position Management</h2>
        </div>
        <div class="card-body">
          <div
            class="danger-zone"
            style="
              padding: 20px;
              background: rgba(255, 51, 102, 0.1);
              border: 2px solid var(--danger);
              border-radius: 8px;
            "
          >
            <h3 style="color: var(--danger); margin-bottom: 10px">
              Danger Zone
            </h3>
            <p style="color: var(--text-secondary); margin-bottom: 15px">
              These actions will immediately affect your open positions. Use
              with caution.
            </p>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button
                class="btn btn-danger"
                onclick="closeAllPositions()"
                style="background: var(--danger); padding: 10px 20px"
              >
                ‚ùå Close All Positions
              </button>
              <button
                class="btn btn-warning"
                onclick="closePositionsBySymbol()"
                style="background: var(--warning); padding: 10px 20px"
              >
                üéØ Close by Symbol
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      const TICK_UPDATE_INTERVAL = 1000; // 1 second
      const DATA_UPDATE_INTERVAL = 5000; // 5 seconds

      let drawdownView = "global"; // 'global' or 'per-pair'

      // Update current time
      function updateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const seconds = String(now.getSeconds()).padStart(2, "0");
        document.getElementById("current-time").textContent =
          `${hours}:${minutes}:${seconds}`;
      }

      setInterval(updateTime, 1000);
      updateTime();

      // Utility functions
      function formatCurrency(value) {
        const num = parseFloat(value);
        return `$${num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
      }

      function formatNumber(value, decimals = 5) {
        return parseFloat(value).toFixed(decimals);
      }

      function getValueClass(value) {
        return parseFloat(value) >= 0 ? "positive" : "negative";
      }

      function calculatePips(symbol, openPrice, currentPrice, type) {
        let diff =
          type === "BUY" ? currentPrice - openPrice : openPrice - currentPrice;
        return symbol.includes("JPY") ? diff * 100 : diff * 10000;
      }

      // Toggle drawdown view
      function toggleDrawdownView(view) {
        drawdownView = view;
        document
          .getElementById("toggle-global")
          .classList.toggle("active", view === "global");
        document
          .getElementById("toggle-per-pair")
          .classList.toggle("active", view === "per-pair");
        updateDrawdownInfo();
      }

      // Update live market data dengan refresh partial
      async function updateMarketData() {
        try {
          const response = await fetch("/api/realtime/all");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          const result = await response.json();
          const data = result.success ? result.data : result;

          if (!data || Object.keys(data).length === 0) {
            document.getElementById("market-data").innerHTML =
              '<div class="no-data">No market data available</div>';
            return;
          }

          // Iterasi setiap simbol market
          for (const [symbol, marketData] of Object.entries(data)) {
            const tick = marketData.tick;
            const ohlc = marketData.ohlc;
            if (!tick || !ohlc) continue;

            const cardId = `market-card-${symbol.replace(/[^a-zA-Z0-9]/g, "-")}`;
            let card = document.getElementById(cardId);

            // Jika kartu belum ada, buat yang baru
            if (!card) {
              const change = ohlc.close - ohlc.open;
              const changePercent = (change / ohlc.open) * 100;
              const changeClass = change >= 0 ? "positive" : "negative";

              const html = `
                    <div class="market-card fade-in" id="${cardId}">
                        <div class="market-header">
                            <div class="market-symbol">${symbol.replace(".s", "")}</div>
                            <div class="market-status">ACTIVE</div>
                        </div>
                        <div class="market-prices">
                            <div class="price-box">
                                <div class="price-label">BID</div>
                                <div class="price-value bid" id="${cardId}-bid">${formatNumber(tick.bid)}</div>
                            </div>
                            <div class="price-box">
                                <div class="price-label">ASK</div>
                                <div class="price-value ask" id="${cardId}-ask">${formatNumber(tick.ask)}</div>
                            </div>
                        </div>
                        <div class="market-details">
                            <div class="detail-item">
                                <div class="detail-label">SPREAD</div>
                                <div class="detail-value" id="${cardId}-spread">${formatNumber(tick.spread, 5)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">CHANGE</div>
                                <div class="detail-value ${changeClass}" id="${cardId}-change">
                                    ${change >= 0 ? "+" : ""}${changePercent.toFixed(2)}%
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">VOLUME</div>
                                <div class="detail-value" id="${cardId}-volume">${tick.volume}</div>
                            </div>
                        </div>
                    </div>
                `;

              document
                .getElementById("market-data")
                .insertAdjacentHTML("beforeend", html);
              continue;
            }

            // Hanya update elemen yang berubah (partial update)
            updateMarketCard(cardId, symbol, tick, ohlc);
          }

          // Hapus kartu yang tidak lagi ada dalam data
          cleanupMarketCards(data);
        } catch (error) {
          console.error("Error updating market data:", error);
          // Tampilkan error tanpa menghapus semua kartu
          showNotification(`Market data error: ${error.message}`, "error");
        }
      }

      // Fungsi untuk update partial kartu market
      function updateMarketCard(cardId, symbol, tick, ohlc) {
        try {
          // Update bid
          const bidElement = document.getElementById(`${cardId}-bid`);
          if (bidElement) {
            bidElement.textContent = formatNumber(tick.bid);
            addPriceFlashEffect(bidElement, tick.bid);
          }

          // Update ask
          const askElement = document.getElementById(`${cardId}-ask`);
          if (askElement) {
            askElement.textContent = formatNumber(tick.ask);
            addPriceFlashEffect(askElement, tick.ask);
          }

          // Update spread
          const spreadElement = document.getElementById(`${cardId}-spread`);
          if (spreadElement) {
            spreadElement.textContent = formatNumber(tick.spread, 5);
          }

          // Update volume
          const volumeElement = document.getElementById(`${cardId}-volume`);
          if (volumeElement) {
            volumeElement.textContent = tick.volume;
          }

          // Update change percentage
          const changeElement = document.getElementById(`${cardId}-change`);
          if (changeElement && ohlc) {
            const change = ohlc.close - ohlc.open;
            const changePercent = (change / ohlc.open) * 100;
            const changeClass = change >= 0 ? "positive" : "negative";

            changeElement.textContent = `${change >= 0 ? "+" : ""}${changePercent.toFixed(2)}%`;
            changeElement.className = `detail-value ${changeClass}`;
          }
        } catch (error) {
          console.error(`Error updating card ${cardId}:`, error);
        }
      }

      // Fungsi untuk membersihkan kartu yang tidak ada dalam data
      function cleanupMarketCards(currentData) {
        const allCards = document.querySelectorAll(".market-card");
        const currentSymbols = Object.keys(currentData).map(
          (s) => `market-card-${s.replace(/[^a-zA-Z0-9]/g, "-")}`,
        );

        allCards.forEach((card) => {
          const cardId = card.id;
          if (!currentSymbols.includes(cardId)) {
            card.remove();
          }
        });
      }

      // Efek flash untuk perubahan harga
      function addPriceFlashEffect(element, newValue) {
        const oldValue = parseFloat(element.dataset.lastValue || 0);
        element.dataset.lastValue = newValue;

        if (oldValue && oldValue !== newValue) {
          element.classList.add("price-update");
          setTimeout(() => {
            element.classList.remove("price-update");
          }, 500);
        }
      }

      // Update account stats
      async function updateAccountStats() {
        try {
          const accountResponse = await fetch("/api/account");
          const account = await accountResponse.json();

          const statsResponse = await fetch("/api/stats");
          const statsData = await statsResponse.json();

          // ‚úÖ Extract nested stats data
          const stats = statsData.stats || {
            win_rate: 0,
            winning_trades: 0,
            losing_trades: 0,
            net_profit: 0,
            profit_factor: 0,
            avg_win: 0,
            avg_loss: 0,
          };

          const profitClass = getValueClass(account.profit);
          const winRateClass = stats.win_rate >= 50 ? "positive" : "negative";

          // ‚úÖ Handle margin level safely (bisa 0)
          const marginLevel =
            account.margin > 0 ? account.margin_level.toFixed(2) : "‚àû";

          const html = `
      <div class="stat-card">
        <div class="stat-header">BALANCE</div>
        <div class="stat-value">${formatCurrency(account.balance)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-header">EQUITY</div>
        <div class="stat-value">${formatCurrency(account.equity)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-header">FLOATING P&L</div>
        <div class="stat-value ${profitClass}">${formatCurrency(account.profit)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-header">NET PROFIT</div>
        <div class="stat-value ${getValueClass(stats.net_profit)}">${formatCurrency(stats.net_profit)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-header">WIN RATE</div>
        <div class="stat-value ${winRateClass}">${stats.win_rate.toFixed(1)}%</div>
        <div class="stat-change ${winRateClass}">
          ${stats.winning_trades}W / ${stats.losing_trades}L
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-header">MARGIN LEVEL</div>
        <div class="stat-value">${marginLevel}%</div>
      </div>
    `;

          document.getElementById("account-stats").innerHTML = html;
        } catch (error) {
          console.error("Error updating account stats:", error);
          // Error handling...
        }
      }

      // Update drawdown info
      async function updateDrawdownInfo() {
        try {
          const response = await fetch("/api/drawdown");
          const drawdown = await response.json();

          let html = "";

          if (drawdownView === "global") {
            // Global drawdown view
            const ddPercent = Math.min(100, drawdown.drawdown_percent);

            html = `
                        <div class="drawdown-card">
                            <div class="drawdown-label">CURRENT DRAWDOWN</div>
                            <div class="drawdown-value">${formatCurrency(drawdown.current_drawdown)}</div>
                            <div class="drawdown-bar">
                                <div class="drawdown-fill" style="width: ${ddPercent}%"></div>
                            </div>
                        </div>
                        <div class="drawdown-card">
                            <div class="drawdown-label">MAX DRAWDOWN</div>
                            <div class="drawdown-value">${formatCurrency(drawdown.max_drawdown)}</div>
                        </div>
                        <div class="drawdown-card">
                            <div class="drawdown-label">DRAWDOWN %</div>
                            <div class="drawdown-value">${drawdown.drawdown_percent.toFixed(2)}%</div>
                        </div>
                        <div class="drawdown-card">
                            <div class="drawdown-label">RECOVERY NEEDED</div>
                            <div class="drawdown-value">${formatCurrency(drawdown.current_drawdown)}</div>
                        </div>
                    `;
          } else {
            // Per-pair drawdown view
            const positionsResponse = await fetch("/api/positions");
            const positions = await positionsResponse.json();

            const pairStats = {};
            positions.forEach((pos) => {
              if (!pairStats[pos.symbol]) {
                pairStats[pos.symbol] = {
                  totalProfit: 0,
                  count: 0,
                  maxLoss: 0,
                };
              }
              pairStats[pos.symbol].totalProfit += pos.profit;
              pairStats[pos.symbol].count += 1;
              if (pos.profit < pairStats[pos.symbol].maxLoss) {
                pairStats[pos.symbol].maxLoss = pos.profit;
              }
            });

            if (Object.keys(pairStats).length === 0) {
              html =
                '<div class="no-data">No active positions to show per-pair drawdown</div>';
            } else {
              for (const [symbol, stats] of Object.entries(pairStats)) {
                const profitClass = getValueClass(stats.totalProfit);
                html += `
                                <div class="drawdown-card">
                                    <div class="drawdown-label">${symbol}</div>
                                    <div class="drawdown-value ${profitClass}">${formatCurrency(stats.totalProfit)}</div>
                                    <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">
                                        ${stats.count} position(s) ‚Ä¢ Max Loss: ${formatCurrency(stats.maxLoss)}
                                    </div>
                                </div>
                            `;
              }
            }
          }

          document.getElementById("drawdown-data").innerHTML = html;
        } catch (error) {
          console.error("Error updating drawdown info:", error);
        }
      }

      // Update strategy info
      async function updateStrategyInfo() {
        try {
          const response = await fetch("/api/strategy");
          const data = await response.json();

          // Extract strategy data - it's nested under data.strategy
          const strategy = data.strategy || {};

          // Format philosophy text (truncate if too long)
          const philosophy = strategy.philosophy || "N/A";
          const shortPhilosophy =
            philosophy.length > 80
              ? philosophy.substring(0, 77) + "..."
              : philosophy;

          // Format timeframes
          const timeframes = strategy.timeframes
            ? strategy.timeframes.join(", ")
            : "N/A";

          // Format trading pairs
          const pairs = strategy.pairs || [];
          const pairsText =
            pairs.length > 0
              ? pairs.slice(0, 5).join(", ") +
                (pairs.length > 5 ? ` (+${pairs.length - 5} more)` : "")
              : "N/A";

          // Format risk per trade
          const riskPerTrade = strategy.risk_per_trade
            ? `${(strategy.risk_per_trade[0] * 100).toFixed(1)}% - ${(strategy.risk_per_trade[1] * 100).toFixed(1)}%`
            : "N/A";

          // Format performance targets
          const performance = strategy.performance_targets || {};
          const winrate = performance.winrate
            ? `${(performance.winrate * 100).toFixed(1)}%`
            : "N/A";
          const profitFactor = performance.profit_factor
            ? performance.profit_factor.toFixed(2)
            : "N/A";
          const monthlyReturn = performance.monthly_return
            ? `${(performance.monthly_return * 100).toFixed(1)}%`
            : "N/A";

          document.getElementById("strategy-info").innerHTML = `
                    <div class="strategy-active">
                        <div class="strategy-icon">üéØ</div>
                        <div class="strategy-info-text">
                            <h3>${strategy.name || "No Strategy Loaded"}</h3>
                            <div class="strategy-meta">
                                üìÑ ${strategy.filename || "No file loaded"}
                            </div>
                            <div class="strategy-details" style="margin-top: 12px; font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                                <div style="margin-bottom: 6px;"><strong style="color: var(--text-primary);">Philosophy:</strong> ${shortPhilosophy}</div>
                                <div style="margin-bottom: 6px;"><strong style="color: var(--text-primary);">Timeframes:</strong> ${timeframes}</div>
                                <div style="margin-bottom: 6px;"><strong style="color: var(--text-primary);">Trading Pairs:</strong> ${pairsText}</div>
                                <div style="margin-bottom: 6px;"><strong style="color: var(--text-primary);">Risk/Trade:</strong> ${riskPerTrade}</div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-primary);">
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-tertiary);">Target Winrate</div>
                                        <div style="font-size: 14px; font-weight: 600; color: var(--success);">${winrate}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-tertiary);">Profit Factor</div>
                                        <div style="font-size: 14px; font-weight: 600; color: var(--accent-cyan);">${profitFactor}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-tertiary);">Monthly Return</div>
                                        <div style="font-size: 14px; font-weight: 600; color: var(--accent-purple);">${monthlyReturn}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="upload-section">
                        <h3>üì§ Deploy New Strategy</h3>
                        <div class="file-input-wrapper">
                            <label class="file-input-label" for="strategy-file">Choose JSON File</label>
                            <input type="file" id="strategy-file" accept=".json" onchange="handleFileSelect(event)">
                        </div>
                        <button class="upload-btn" id="upload-btn" onclick="uploadStrategy()" disabled>DEPLOY STRATEGY</button>
                        <div id="selected-file" class="selected-file"></div>
                        <div id="upload-message"></div>
                    </div>
                `;
        } catch (error) {
          console.error("Error updating strategy info:", error);
          document.getElementById("strategy-info").innerHTML = `
                    <div class="strategy-active">
                        <div class="strategy-icon">‚ö†Ô∏è</div>
                        <div class="strategy-info-text">
                            <h3>Error Loading Strategy</h3>
                            <div class="strategy-meta" style="color: var(--danger);">
                                Failed to load strategy information
                            </div>
                        </div>
                    </div>
                    <div class="upload-section">
                        <h3>üì§ Deploy New Strategy</h3>
                        <div class="file-input-wrapper">
                            <label class="file-input-label" for="strategy-file">Choose JSON File</label>
                            <input type="file" id="strategy-file" accept=".json" onchange="handleFileSelect(event)">
                        </div>
                        <button class="upload-btn" id="upload-btn" onclick="uploadStrategy()" disabled>DEPLOY STRATEGY</button>
                        <div id="selected-file" class="selected-file"></div>
                        <div id="upload-message"></div>
                    </div>
                `;
        }
      }

      // Update positions
      async function updatePositions() {
        try {
          const response = await fetch("/api/positions");
          const positions = await response.json();

          document.getElementById("position-count").textContent =
            positions.length;

          if (positions.length === 0) {
            document.getElementById("positions").innerHTML =
              '<div class="no-data">üì≠ No active positions</div>';
            return;
          }

          let html = "";
          positions.forEach((pos) => {
            const profitClass = getValueClass(pos.profit);
            const typeClass = pos.type.toLowerCase();
            const pips = calculatePips(
              pos.symbol,
              pos.open_price,
              pos.current_price,
              pos.type,
            );

            html += `
                        <div class="position-item fade-in">
                            <div class="position-header-row">
                                <div class="position-symbol-row">
                                    <div class="position-symbol">${pos.symbol}</div>
                                    <div class="position-type ${typeClass}">${pos.type}</div>
                                </div>
                                <div class="position-profit ${profitClass}">${formatCurrency(pos.profit)}</div>
                            </div>
                            <div class="position-details">
                                <div class="position-detail">
                                    <div class="position-detail-label">VOLUME</div>
                                    <div class="position-detail-value">${pos.volume}</div>
                                </div>
                                <div class="position-detail">
                                    <div class="position-detail-label">ENTRY</div>
                                    <div class="position-detail-value">${formatNumber(pos.open_price)}</div>
                                </div>
                                <div class="position-detail">
                                    <div class="position-detail-label">CURRENT</div>
                                    <div class="position-detail-value">${formatNumber(pos.current_price)}</div>
                                </div>
                                <div class="position-detail">
                                    <div class="position-detail-label">PIPS</div>
                                    <div class="position-detail-value ${profitClass}">${pips > 0 ? "+" : ""}${pips.toFixed(1)}</div>
                                </div>
                                <div class="position-detail">
                                    <div class="position-detail-label">SL</div>
                                    <div class="position-detail-value">${formatNumber(pos.sl)}</div>
                                </div>
                                <div class="position-detail">
                                    <div class="position-detail-label">TP</div>
                                    <div class="position-detail-value">${formatNumber(pos.tp)}</div>
                                </div>
                            </div>
                        </div>
                    `;
          });

          document.getElementById("positions").innerHTML = html;
        } catch (error) {
          console.error("Error updating positions:", error);
        }
      }

      // Update trades
      async function updateTrades() {
        try {
          const response = await fetch("/api/trades");
          const trades = await response.json();

          document.getElementById("trade-count").textContent = trades.length;

          if (trades.length === 0) {
            document.getElementById("trades").innerHTML =
              '<div class="no-data">üìã No trades today</div>';
            return;
          }

          let html = "";
          trades.slice(0, 15).forEach((trade) => {
            const profitClass = getValueClass(trade.profit);
            const typeClass = trade.type.toLowerCase();

            html += `
                        <div class="trade-item fade-in">
                            <div class="trade-info">
                                <div class="trade-time">${trade.time.split(" ")[1]}</div>
                                <div class="trade-symbol">${trade.symbol}</div>
                                <div class="trade-type ${typeClass}">${trade.type}</div>
                                <div style="font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-secondary);">
                                    ${formatNumber(trade.price)} ‚Ä¢ ${trade.volume} lots
                                </div>
                            </div>
                            <div class="trade-profit ${profitClass}">${formatCurrency(trade.profit)}</div>
                        </div>
                    `;
          });

          if (trades.length > 15) {
            html += `<div class="no-data" style="padding: 12px;">... and ${trades.length - 15} more trades</div>`;
          }

          document.getElementById("trades").innerHTML = html;
        } catch (error) {
          console.error("Error updating trades:", error);
        }
      }

      // File handling
      function handleFileSelect(event) {
        const file = event.target.files[0];
        const selectedFileDiv = document.getElementById("selected-file");
        const uploadBtn = document.getElementById("upload-btn");

        if (file) {
          // Validate file size (max 5MB)
          const maxSize = 5 * 1024 * 1024; // 5MB
          if (file.size > maxSize) {
            selectedFileDiv.innerHTML = `<span style="color: var(--danger);">‚ùå File too large (max 5MB)</span>`;
            uploadBtn.disabled = true;
            return;
          }

          // Validate file type
          if (!file.name.toLowerCase().endsWith(".json")) {
            selectedFileDiv.innerHTML = `<span style="color: var(--danger);">‚ùå Only JSON files allowed</span>`;
            uploadBtn.disabled = true;
            return;
          }

          selectedFileDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="color: var(--success);">‚úì</span>
                <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
            </div>
        `;
          uploadBtn.disabled = false;
        } else {
          selectedFileDiv.innerHTML = "";
          uploadBtn.disabled = true;
        }
      }

      async function uploadStrategy() {
        const fileInput = document.getElementById("strategy-file");
        const file = fileInput.files[0];

        if (!file) return;

        const formData = new FormData();
        formData.append("file", file);

        const uploadBtn = document.getElementById("upload-btn");
        const uploadMessage = document.getElementById("upload-message");

        uploadBtn.disabled = true;
        uploadBtn.textContent = "DEPLOYING...";
        uploadMessage.innerHTML =
          '<div class="loading">Uploading strategy file...</div>';

        try {
          // Step 1: Upload file
          uploadMessage.innerHTML =
            '<div class="loading">üì§ Uploading file...</div>';

          const response = await fetch("/api/strategy/upload", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (data.success) {
            uploadMessage.innerHTML = `
                <div class="success">‚úÖ File uploaded: ${data.filename}</div>
                <div class="success">üìã Strategy: ${data.strategy_info.name}</div>
            `;

            // Step 2: Auto-refresh dashboard info
            setTimeout(async () => {
              uploadMessage.innerHTML +=
                '<div class="success">üîÑ Updating dashboard...</div>';

              // Update strategy info
              await updateStrategyInfo();

              // Update market data (in case symbols changed)
              await updateMarketData();

              // Show final success
              uploadMessage.innerHTML +=
                '<div class="success">‚ú® Dashboard updated!</div>';

              // Show notification
              showNotification(
                `Strategy "${data.strategy_info.name}" deployed successfully!`,
                "success",
              );

              // Clear form
              fileInput.value = "";
              document.getElementById("selected-file").textContent = "";

              // Clear messages after 5 seconds
              setTimeout(() => {
                uploadMessage.innerHTML = "";
              }, 5000);
            }, 1000);
          } else {
            uploadMessage.innerHTML = `<div class="error">‚ùå ${data.error}</div>`;
            showNotification("Strategy upload failed", "error");
          }
        } catch (error) {
          uploadMessage.innerHTML = `<div class="error">‚ùå Upload failed: ${error.message}</div>`;
          showNotification("Network error during upload", "error");
          console.error("Upload error:", error);
        } finally {
          uploadBtn.disabled = false;
          uploadBtn.textContent = "DEPLOY STRATEGY";
        }
      }
      // Initialize dashboard
      function initDashboard() {
        updateMarketData();
        updateAccountStats();
        updateDrawdownInfo();
        updateStrategyInfo();
        updatePositions();
        updateTrades();

        setInterval(updateMarketData, TICK_UPDATE_INTERVAL);
        setInterval(() => {
          updateAccountStats();
          updateDrawdownInfo();
          updatePositions();
          updateTrades();
        }, DATA_UPDATE_INTERVAL);
      }

      window.addEventListener("load", initDashboard);

      //extension dashboard

      let currentNewsTab = "upcoming";
      let currentNewsFilter = "all";

      async function loadNews() {
        await loadUpcomingNews();
        await loadRecentNews();
      }

      async function loadUpcomingNews() {
        try {
          const impact =
            currentNewsFilter === "all" ? "" : `&impact=${currentNewsFilter}`;
          const response = await fetch(`/api/news/upcoming?hours=48${impact}`);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const result = await response.json();

          // FIX: Handle response format
          const newsData = result.success ? result.news : result;

          const container = document.getElementById("upcomingNewsList");

          if (!newsData || newsData.length === 0) {
            container.innerHTML = '<div class="loading">No upcoming news</div>';
            return;
          }

          container.innerHTML = newsData
            .map(
              (item) => `
      <div class="news-item impact-${item.impact.toLowerCase()}">
        <div class="news-time">${formatNewsTime(item.event_time)} (${getTimeUntil(item.event_time)})</div>
        <div class="news-title">
          <span style="background: ${getImpactColor(item.impact)}; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 8px;">${item.impact}</span>
          ${item.currency} - ${item.title}
        </div>
        <div class="news-details">
          <span>Country: ${item.country}</span>
          ${item.forecast ? `<span>Forecast: ${item.forecast}</span>` : ""}
          ${item.previous ? `<span>Previous: ${item.previous}</span>` : ""}
        </div>
      </div>
    `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading upcoming news:", error);
          document.getElementById("upcomingNewsList").innerHTML =
            `<div class="loading" style="color: var(--danger);">Error: ${error.message}</div>`;
        }
      }

      async function loadRecentNews() {
        try {
          const impact =
            currentNewsFilter === "all" ? "" : `&impact=${currentNewsFilter}`;
          const response = await fetch(`/api/news/recent?hours=24${impact}`);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const result = await response.json();
          const newsData = result.success ? result.news : result;

          const container = document.getElementById("recentNewsList");

          if (!newsData || newsData.length === 0) {
            container.innerHTML = '<div class="loading">No recent news</div>';
            return;
          }

          container.innerHTML = newsData
            .map(
              (item) => `
      <div class="news-item impact-${item.impact.toLowerCase()}">
        <div class="news-time">${formatNewsTime(item.event_time)} (${getTimeAgo(item.event_time)})</div>
        <div class="news-title">
          <span style="background: ${getImpactColor(item.impact)}; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 8px;">${item.impact}</span>
          ${item.currency} - ${item.title}
        </div>
        <div class="news-details">
          <span>Country: ${item.country}</span>
          ${item.actual ? `<span>Actual: ${item.actual}</span>` : ""}
          ${item.forecast ? `<span>Forecast: ${item.forecast}</span>` : ""}
          ${item.previous ? `<span>Previous: ${item.previous}</span>` : ""}
        </div>
      </div>
    `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading recent news:", error);
          document.getElementById("recentNewsList").innerHTML =
            `<div class="loading" style="color: var(--danger);">Error: ${error.message}</div>`;
        }
      }

      async function refreshNews() {
        const icon = document.getElementById("newsRefreshIcon");
        icon.style.animation = "spin 1s linear infinite";

        try {
          const response = await fetch("/api/news/update", { method: "POST" });
          const result = await response.json();

          if (result.success) {
            showNotification(`Updated ${result.count} news items`, "success");
            await loadNews();
          }
        } catch (error) {
          console.error("Error refreshing news:", error);
          showNotification("Error refreshing news", "error");
        }

        setTimeout(() => {
          icon.style.animation = "";
        }, 1000);
      }

      function switchNewsTab(tab) {
        currentNewsTab = tab;

        // Update tab buttons
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Update tab content
        document.getElementById("upcomingNewsTab").style.display =
          tab === "upcoming" ? "block" : "none";
        document.getElementById("recentNewsTab").style.display =
          tab === "recent" ? "block" : "none";
      }

      function filterNews() {
        currentNewsFilter = document.getElementById("newsFilter").value;
        loadNews();
      }

      function getImpactColor(impact) {
        const colors = {
          High: "var(--danger)",
          Medium: "var(--warning)",
          Low: "var(--text-tertiary)",
        };
        return colors[impact] || "var(--text-tertiary)";
      }

      function formatNewsTime(timeStr) {
        const date = new Date(timeStr);
        return date.toLocaleString("en-US", {
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function getTimeUntil(timeStr) {
        const now = new Date();
        const target = new Date(timeStr);
        const diff = target - now;

        if (diff < 0) return "Past";

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

        if (hours > 24) {
          const days = Math.floor(hours / 24);
          return `in ${days}d ${hours % 24}h`;
        }

        return `in ${hours}h ${minutes}m`;
      }

      function getTimeAgo(timeStr) {
        const now = new Date();
        const target = new Date(timeStr);
        const diff = now - target;

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

        if (hours > 24) {
          const days = Math.floor(hours / 24);
          return `${days}d ${hours % 24}h ago`;
        }

        return `${hours}h ${minutes}m ago`;
      }

      async function loadTradeHistory() {
        const days = document.getElementById("historyDaysFilter").value;
        const url = `/api/history/trades${days ? `?days=${days}&limit=200` : "?limit=200"}`;

        try {
          const response = await fetch(url);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const result = await response.json();

          // FIX: Handle response format
          const trades = result.success ? result.trades : result;

          const tbody = document.getElementById("tradeHistoryTable");

          if (!trades || trades.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="13" class="loading">No trade history found</td></tr>';
            await loadTradeStats(); // Still load stats
            return;
          }

          tbody.innerHTML = trades
            .map((trade) => {
              const netPL =
                trade.profit + (trade.commission || 0) + (trade.swap || 0);
              const duration = formatDuration(trade.duration_seconds);
              const profitClass =
                netPL >= 0 ? "profit-positive" : "profit-negative";

              return `
        <tr>
          <td>${trade.ticket}</td>
          <td><strong>${trade.symbol}</strong></td>
          <td><span class="badge ${trade.type === "BUY" ? "badge-success" : "badge-danger"}">${trade.type}</span></td>
          <td>${trade.volume.toFixed(2)}</td>
          <td>${trade.open_price.toFixed(5)}</td>
          <td>${trade.close_price.toFixed(5)}</td>
          <td>${new Date(trade.open_time).toLocaleString()}</td>
          <td>${new Date(trade.close_time).toLocaleString()}</td>
          <td>${duration}</td>
          <td class="${trade.profit >= 0 ? "profit-positive" : "profit-negative"}">$${trade.profit.toFixed(2)}</td>
          <td>$${(trade.commission || 0).toFixed(2)}</td>
          <td>$${(trade.swap || 0).toFixed(2)}</td>
          <td class="${profitClass}"><strong>$${netPL.toFixed(2)}</strong></td>
        </tr>
      `;
            })
            .join("");

          await loadTradeStats();
        } catch (error) {
          console.error("Error loading trade history:", error);
          document.getElementById("tradeHistoryTable").innerHTML =
            `<tr><td colspan="13" class="loading" style="color: var(--danger);">Error: ${error.message}</td></tr>`;
        }
      }

      async function loadTradeStats() {
        const days = document.getElementById("historyDaysFilter").value;
        const url = `/api/history/statistics${days ? `?days=${days}` : ""}`;

        try {
          const response = await fetch(url);
          const result = await response.json();

          // FIX: Handle response format
          const stats = result.success ? result.statistics : result;

          const container = document.getElementById("tradeStats");
          container.innerHTML = `
      <div class="stat-card">
        <div class="stat-label">Total Trades</div>
        <div class="stat-value">${stats.total_trades || 0}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Win Rate</div>
        <div class="stat-value" style="color: ${(stats.win_rate || 0) >= 50 ? "var(--success)" : "var(--danger)"}">
          ${(stats.win_rate || 0).toFixed(1)}%
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Net Profit</div>
        <div class="stat-value" style="color: ${(stats.net_profit || 0) >= 0 ? "var(--success)" : "var(--danger)"}">
          $${(stats.net_profit || 0).toFixed(2)}
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Profit Factor</div>
        <div class="stat-value">${(stats.profit_factor || 0).toFixed(2)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Avg Win</div>
        <div class="stat-value" style="color: var(--success)">$${(stats.avg_win || 0).toFixed(2)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Avg Loss</div>
        <div class="stat-value" style="color: var(--danger)">$${(stats.avg_loss || 0).toFixed(2)}</div>
      </div>
    `;
        } catch (error) {
          console.error("Error loading trade stats:", error);
        }
      }

      async function syncTradeHistory() {
        const icon = document.getElementById("syncIcon");
        icon.style.animation = "spin 1s linear infinite";

        try {
          const response = await fetch("/api/history/sync", { method: "POST" });
          const result = await response.json();

          if (result.success) {
            showNotification(
              `Synced ${result.count} trades from MT5`,
              "success",
            );
            await loadTradeHistory();
          }
        } catch (error) {
          console.error("Error syncing trade history:", error);
          showNotification("Error syncing trade history", "error");
        }

        setTimeout(() => {
          icon.style.animation = "";
        }, 1000);
      }

      async function exportTradeHistory() {
        const days = document.getElementById("historyDaysFilter").value;
        const url = `/api/history/export${days ? `?days=${days}` : ""}`;

        window.open(url, "_blank");
        showNotification("Exporting trade history...", "info");
      }
      function formatDuration(seconds) {
        if (!seconds) return "N/A";

        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);

        if (hours > 24) {
          const days = Math.floor(hours / 24);
          return `${days}d ${hours % 24}h`;
        }

        return `${hours}h ${minutes}m`;
      }

      // Position Management Functions
      async function closeAllPositions() {
        if (
          !confirm(
            "Are you sure you want to CLOSE ALL open positions? This action cannot be undone!",
          )
        ) {
          return;
        }

        if (
          !confirm(
            "FINAL WARNING: This will close ALL your open positions immediately!",
          )
        ) {
          return;
        }

        try {
          const response = await fetch("/api/positions/close-all", {
            method: "POST",
          });
          const result = await response.json();

          if (result.success) {
            showNotification(result.message, "success");
            // Refresh positions
            setTimeout(() => {
              location.reload();
            }, 2000);
          } else {
            showNotification("Error: " + result.error, "error");
          }
        } catch (error) {
          console.error("Error closing all positions:", error);
          showNotification("Error closing positions", "error");
        }
      }

      async function closePositionsBySymbol() {
        const symbol = prompt(
          "Enter symbol to close all positions (e.g., EURUSD.s):",
        );

        if (!symbol) return;

        if (!confirm(`Close all ${symbol} positions?`)) {
          return;
        }

        try {
          const response = await fetch(
            `/api/positions/close-symbol/${symbol}`,
            { method: "POST" },
          );
          const result = await response.json();

          if (result.success) {
            showNotification(result.message, "success");
            setTimeout(() => {
              location.reload();
            }, 2000);
          } else {
            showNotification("Error: " + result.error, "error");
          }
        } catch (error) {
          console.error("Error closing positions:", error);
          showNotification("Error closing positions", "error");
        }
      }

      function showNotification(message, type = "info") {
        // Create notification element
        const notification = document.createElement("div");
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === "success" ? "var(--success)" : type === "error" ? "var(--danger)" : "var(--accent-cyan)"};
        color: white;
        border-radius: 8px;
        z-index: 10000;
        animation: slideIn 0.3s ease;
        box-shadow: var(--shadow-lg);
    `;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "slideOut 0.3s ease";
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // Add to existing initialization
      document.addEventListener("DOMContentLoaded", function () {
        // Load news and trade history
        loadNews();
        loadTradeHistory();

        // Auto-refresh news every 5 minutes
        setInterval(loadNews, 5 * 60 * 1000);

        // Auto-refresh trade history every 30 seconds
        setInterval(loadTradeHistory, 30 * 1000);
      });

      // Add animation styles
      const style = document.createElement("style");
      style.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
    
    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .badge-success {
        background: var(--success-glow);
        color: var(--success);
    }
    
    .badge-danger {
        background: var(--danger-glow);
        color: var(--danger);
    }
    
    /* Loading animation */
    .loading {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--accent-cyan);
        font-size: 14px;
    }
    
    .loading::before {
        content: "";
        width: 16px;
        height: 16px;
        border: 2px solid var(--accent-cyan);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
`;
      document.head.appendChild(style);
    </script>
  </body>
</html>
